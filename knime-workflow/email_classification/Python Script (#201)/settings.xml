<?xml version="1.0" encoding="UTF-8"?>
<config xmlns="http://www.knime.org/2008/09/XMLConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.knime.org/2008/09/XMLConfig http://www.knime.org/XMLConfig_2008_09.xsd" key="settings.xml">
    <entry key="node_file" type="xstring" value="settings.xml"/>
    <config key="flow_stack"/>
    <config key="internal_node_subsettings">
        <entry key="memory_policy" type="xstring" value="CacheSmallInMemory"/>
    </config>
    <config key="model">
        <entry key="python3_command" type="xstring" value=""/>
        <entry key="script" type="xstring" value="import knime.scripting.io as knio%%00010import pandas as pd%%00010import numpy as np%%00010import torch%%00010%%00010from datasets import Dataset%%00010from transformers import (%%00010    AutoTokenizer,%%00010    AutoModelForSequenceClassification,%%00010    Trainer,%%00010    TrainingArguments,%%00010)%%00010%%00010%%00010# ============================================================%%00010# ---------------------- CONFIG ------------------------------%%00010# ============================================================%%00010%%00010MODEL_NAME = &quot;prajjwal1/bert-tiny&quot;   # lightweight model for workflow%%00010MAX_LENGTH = 256%%00010BATCH_SIZE = 16%%00010NUM_EPOCHS = 8%%00010LEARNING_RATE = 5e-4%%00010RANDOM_SEED = 198%%00010%%00010# ============================================================%%00010%%00010%%00010def set_seeds(seed: int = RANDOM_SEED):%%00010    torch.manual_seed(seed)%%00010    np.random.seed(seed)%%00010%%00010%%00010def get_device():%%00010    if torch.backends.mps.is_available():%%00010        return torch.device(&quot;mps&quot;)%%00010    if torch.cuda.is_available():%%00010        return torch.device(&quot;cuda&quot;)%%00010    return torch.device(&quot;cpu&quot;)%%00010%%00010%%00010def build_label_mapping(train_df, val_df):%%00010    labels = sorted(set(train_df[&quot;email_type&quot;].unique()) |%%00010                    set(val_df[&quot;email_type&quot;].unique()))%%00010    label2id = {label: i for i, label in enumerate(labels)}%%00010    id2label = {i: label for label, i in label2id.items()}%%00010    return label2id, id2label%%00010%%00010%%00010def df_to_dataset(df, label2id):%%00010    df = df.copy()%%00010    df[&quot;label&quot;] = df[&quot;email_type&quot;].map(label2id)%%00010    return Dataset.from_pandas(df[[&quot;text&quot;, &quot;label&quot;]])%%00010%%00010%%00010def tokenize_datasets(tokenizer, train_ds, val_ds):%%00010    def preprocess(batch):%%00010        return tokenizer(%%00010            batch[&quot;text&quot;],%%00010            truncation=True,%%00010            padding=&quot;max_length&quot;,%%00010            max_length=MAX_LENGTH,%%00010        )%%00010%%00010    train_ds = train_ds.map(preprocess, batched=True)%%00010    val_ds = val_ds.map(preprocess, batched=True)%%00010%%00010    train_ds = train_ds.remove_columns([&quot;text&quot;])%%00010    val_ds = val_ds.remove_columns([&quot;text&quot;])%%00010%%00010    train_ds.set_format(&quot;torch&quot;)%%00010    val_ds.set_format(&quot;torch&quot;)%%00010%%00010    return train_ds, val_ds%%00010%%00010%%00010def compute_accuracy(eval_pred):%%00010    logits, labels = eval_pred%%00010    preds = np.argmax(logits, axis=-1)%%00010    return {&quot;accuracy&quot;: (preds == labels).mean().item()}%%00010%%00010%%00010def train_and_predict(train_df, val_df):%%00010    assert &quot;text&quot; in train_df and &quot;email_type&quot; in train_df%%00010    assert &quot;text&quot; in val_df and &quot;email_type&quot; in val_df%%00010%%00010    set_seeds(RANDOM_SEED)%%00010    device = get_device()%%00010%%00010    # ----- Label mapping -----%%00010    label2id, id2label = build_label_mapping(train_df, val_df)%%00010%%00010    # ----- HF datasets -----%%00010    train_ds = df_to_dataset(train_df, label2id)%%00010    val_ds = df_to_dataset(val_df, label2id)%%00010%%00010    # ----- Load model &amp; tokenizer -----%%00010    tokenizer = AutoTokenizer.from_pretrained(MODEL_NAME)%%00010    model = AutoModelForSequenceClassification.from_pretrained(%%00010        MODEL_NAME,%%00010        num_labels=len(label2id),%%00010        label2id=label2id,%%00010        id2label=id2label,%%00010    ).to(device)%%00010%%00010    # ----- Tokenization -----%%00010    train_ds, val_ds = tokenize_datasets(tokenizer, train_ds, val_ds)%%00010%%00010    # ----- Trainer -----%%00010    training_args = TrainingArguments(%%00010        output_dir=&quot;./knime_temp&quot;,    # ignored, but required by Trainer API%%00010        learning_rate=LEARNING_RATE,%%00010        per_device_train_batch_size=BATCH_SIZE,%%00010        per_device_eval_batch_size=BATCH_SIZE,%%00010        num_train_epochs=NUM_EPOCHS,%%00010        weight_decay=0.01,%%00010        logging_steps=50,%%00010        seed=RANDOM_SEED,%%00010        save_strategy=&quot;no&quot;,           # DON'T save any checkpoints%%00010    )%%00010%%00010    trainer = Trainer(%%00010        model=model,%%00010        args=training_args,%%00010        train_dataset=train_ds,%%00010        eval_dataset=val_ds,%%00010        tokenizer=tokenizer,%%00010        compute_metrics=compute_accuracy,%%00010    )%%00010%%00010    # ----- Train model -----%%00010    trainer.train()%%00010%%00010    # ----- Predict on validation -----%%00010    preds = trainer.predict(val_ds).predictions%%00010    pred_ids = np.argmax(preds, axis=-1)%%00010    pred_labels = [id2label[int(i)] for i in pred_ids]%%00010%%00010    # ----- Add predictions -----%%00010    val_with_pred = val_df.copy()%%00010    val_with_pred[&quot;Prediction()&quot;] = pred_labels%%00010%%00010    return val_with_pred%%00010%%00010%%00010# ============================================================%%00010# ----------------------- KNIME I/O --------------------------%%00010# ============================================================%%00010%%00010# Input table 0 → train set%%00010# Input table 1 → validation set%%00010train_df = knio.input_tables[0].to_pandas()%%00010val_df   = knio.input_tables[1].to_pandas()%%00010%%00010val_with_preds = train_and_predict(train_df, val_df)%%00010%%00010# Output table → validation + Prediction()%%00010knio.output_tables[0] = knio.Table.from_pandas(val_with_preds)%%00010"/>
    </config>
    <config key="variables">
        <entry key="version" type="xstring" value="V_2019_09_13"/>
        <config key="tree">
            <config key="python3_command">
                <entry key="used_variable" type="xstring" value=""/>
                <entry key="used_variable_flawed" type="xboolean" value="false"/>
                <entry key="exposed_variable" type="xstring" isnull="true" value=""/>
            </config>
        </config>
    </config>
    <config key="nodeAnnotation">
        <entry key="text" type="xstring" value="BERT Finetuning"/>
        <entry key="contentType" type="xstring" value="text/plain"/>
        <entry key="bgcolor" type="xint" value="16777215"/>
        <entry key="x-coordinate" type="xint" value="0"/>
        <entry key="y-coordinate" type="xint" value="0"/>
        <entry key="width" type="xint" value="0"/>
        <entry key="height" type="xint" value="0"/>
        <entry key="alignment" type="xstring" value="CENTER"/>
        <entry key="borderSize" type="xint" value="0"/>
        <entry key="borderColor" type="xint" value="0"/>
        <entry key="defFontSize" type="xint" value="-1"/>
        <entry key="annotation-version" type="xint" value="20230412"/>
        <config key="styles"/>
    </config>
    <entry key="customDescription" type="xstring" isnull="true" value=""/>
    <entry key="state" type="xstring" value="EXECUTED"/>
    <entry key="factory" type="xstring" value="org.knime.python3.scripting.nodes2.script.PythonScriptNodeFactory"/>
    <entry key="node-name" type="xstring" value="Python Script"/>
    <entry key="node-bundle-name" type="xstring" value="KNIME Python 3 - Scripting Nodes"/>
    <entry key="node-bundle-symbolic-name" type="xstring" value="org.knime.python3.scripting.nodes"/>
    <entry key="node-bundle-vendor" type="xstring" value="KNIME AG, Zurich, Switzerland"/>
    <entry key="node-bundle-version" type="xstring" value="5.8.0.v202510031553"/>
    <entry key="node-feature-name" type="xstring" value="KNIME Python Integration"/>
    <entry key="node-feature-symbolic-name" type="xstring" value="org.knime.features.python3.scripting.feature.group"/>
    <entry key="node-feature-vendor" type="xstring" value="KNIME AG, Zurich, Switzerland"/>
    <entry key="node-feature-version" type="xstring" value="5.8.0.v202510031553"/>
    <config key="factory_settings"/>
    <config key="node_creation_config">
        <config key="Input object (pickled)"/>
        <config key="Input table">
            <config key="port_0">
                <entry key="object_class" type="xstring" value="org.knime.core.node.BufferedDataTable"/>
            </config>
            <config key="port_1">
                <entry key="object_class" type="xstring" value="org.knime.core.node.BufferedDataTable"/>
            </config>
        </config>
        <config key="Output table">
            <config key="port_0">
                <entry key="object_class" type="xstring" value="org.knime.core.node.BufferedDataTable"/>
            </config>
        </config>
        <config key="Output image"/>
        <config key="Output object (pickled)"/>
    </config>
    <entry key="name" type="xstring" value="Python Script"/>
    <entry key="hasContent" type="xboolean" value="true"/>
    <entry key="isInactive" type="xboolean" value="false"/>
    <config key="ports">
        <config key="port_1">
            <entry key="index" type="xint" value="1"/>
            <entry key="port_spec_class" type="xstring" value="org.knime.core.data.DataTableSpec"/>
            <entry key="port_object_class" type="xstring" value="org.knime.core.node.BufferedDataTable"/>
            <entry key="port_object_summary" type="xstring" value="Rows: 139, Cols: 10"/>
            <entry key="port_dir_location" type="xstring" value="port_1"/>
        </config>
    </config>
    <config key="filestores">
        <entry key="file_store_location" type="xstring" isnull="true" value=""/>
        <entry key="file_store_id" type="xstring" value="70450129-a093-4fd2-ac0e-25ff57e4bd0e"/>
    </config>
</config>
